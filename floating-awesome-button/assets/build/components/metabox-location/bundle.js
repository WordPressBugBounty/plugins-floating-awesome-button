var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function l(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e,t,n,o){return e[1]&&o?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](o(t))):n.ctx}function i(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode&&e.parentNode.removeChild(e)}function s(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function f(){return d(" ")}function p(){return d("")}function m(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function h(e,t,n){for(let n=0;n<e.options.length;n+=1){const o=e.options[n];if(o.__value===t)return void(o.selected=!0)}n&&void 0===t||(e.selectedIndex=-1)}let _;function $(e){_=e}function y(){if(!_)throw new Error("Function called outside component initialization");return _}function b(e){y().$$.on_mount.push(e)}function v(){const e=y();return(t,n,{cancelable:o=!1}={})=>{const l=e.$$.callbacks[t];if(l){const r=function(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const l=document.createEvent("CustomEvent");return l.initCustomEvent(e,n,o,t),l}(t,n,{cancelable:o});return l.slice().forEach((t=>{t.call(e,r)})),!r.defaultPrevented}return!0}}const x=[],w=[];let O=[];const G=[],A=Promise.resolve();let k=!1;function I(e){O.push(e)}const T=new Set;let E=0;function M(){if(0!==E)return;const e=_;do{try{for(;E<x.length;){const e=x[E];E++,$(e),j(e.$$)}}catch(e){throw x.length=0,E=0,e}for($(null),x.length=0,E=0;w.length;)w.pop()();for(let e=0;e<O.length;e+=1){const t=O[e];T.has(t)||(T.add(t),t())}O.length=0}while(x.length);for(;G.length;)G.pop()();k=!1,T.clear(),$(e)}function j(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(I)}}const C=new Set;let N;function L(){N={r:0,c:[],p:N}}function B(){N.r||o(N.c),N=N.p}function Q(e,t){e&&e.i&&(C.delete(e),e.i(t))}function V(e,t,n,o){if(e&&e.o){if(C.has(e))return;C.add(e),N.c.push((()=>{C.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}else o&&o()}function F(e,t){V(e,1,1,(()=>{t.delete(e.key)}))}function H(e,t,n,l,r,a,i,c,u,s,d,f){let p=e.length,m=a.length,g=p;const h={};for(;g--;)h[e[g].key]=g;const _=[],$=new Map,y=new Map,b=[];for(g=m;g--;){const e=f(r,a,g),o=n(e);let c=i.get(o);c?l&&b.push((()=>c.p(e,t))):(c=s(o,e),c.c()),$.set(o,_[g]=c),o in h&&y.set(o,Math.abs(g-h[o]))}const v=new Set,x=new Set;function w(e){Q(e,1),e.m(c,d),i.set(e.key,e),d=e.first,m--}for(;p&&m;){const t=_[m-1],n=e[p-1],o=t.key,l=n.key;t===n?(d=t.first,p--,m--):$.has(l)?!i.has(o)||v.has(o)?w(t):x.has(l)?p--:y.get(o)>y.get(l)?(x.add(o),w(t)):(v.add(l),p--):(u(n,i),p--)}for(;p--;){const t=e[p];$.has(t.key)||u(t,i)}for(;m;)w(_[m-1]);return o(b),_}function S(e){e&&e.c()}function D(e,n,r,a){const{fragment:i,after_update:c}=e.$$;i&&i.m(n,r),a||I((()=>{const n=e.$$.on_mount.map(t).filter(l);e.$$.on_destroy?e.$$.on_destroy.push(...n):o(n),e.$$.on_mount=[]})),c.forEach(I)}function R(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];O.forEach((o=>-1===e.indexOf(o)?t.push(o):n.push(o))),n.forEach((e=>e())),O=t}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function X(e,t){-1===e.$$.dirty[0]&&(x.push(e),k||(k=!0,A.then(M)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function W(t,l,r,a,i,c,s,d=[-1]){const f=_;$(t);const p=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:i,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(f?f.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:l.target||f.$$.root};s&&s(p.root);let m=!1;if(p.ctx=r?r(t,l.props||{},((e,n,...o)=>{const l=o.length?o[0]:n;return p.ctx&&i(p.ctx[e],p.ctx[e]=l)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](l),m&&X(t,e)),n})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!a&&a(p.ctx),l.target){if(l.hydrate){const e=function(e){return Array.from(e.childNodes)}(l.target);p.fragment&&p.fragment.l(e),e.forEach(u)}else p.fragment&&p.fragment.c();l.intro&&Q(t.$$.fragment),D(t,l.target,l.anchor,l.customElement),M()}$(f)}class q{$destroy(){R(this,1),this.$destroy=e}$on(t,n){if(!l(n))return e;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const e=o.indexOf(n);-1!==e&&o.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function P(t){let n,l,r,a,d,p,h,_,$,y,b,v,x,w,O,G,A,k,I,T,E,M,j,C,N,L;return{c(){n=s("div"),l=s("div"),l.innerHTML='<div class="inline-block py-2.5 mx-auto px-5 bg-white text-gray-500 border border-text-gray-300 rounded-md cursor-grab"><em class="fas fa-bars"></em></div>',r=f(),a=s("div"),d=s("select"),h=f(),_=s("div"),$=s("select"),b=f(),v=s("div"),x=s("select"),O=f(),G=s("div"),A=s("select"),I=f(),T=s("div"),E=s("button"),E.innerHTML='<em class="fas fa-minus"></em>',M=f(),j=s("button"),j.innerHTML='<em class="fas fa-plus"></em>',g(l,"class","w-14"),g(d,"name",p="fab_location_type["+t[1].id+"][]"),g(d,"class","select2"),g(a,"class","w-2/12"),g($,"name",y="fab_location_operator["+t[1].id+"][]"),g($,"class","select2"),g(_,"class","w-2/12"),g(x,"name",w="fab_location_value["+t[1].id+"][]"),g(x,"class","w-full select2"),g(v,"class","w-4/12"),g(A,"name",k="fab_location_logic["+t[1].id+"][]"),g(A,"class","w-full select2"),g(G,"class","w-1/12"),g(E,"type","button"),g(E,"class","remove-rule-item py-2.5 mx-auto px-5 bg-danger-600 text-white rounded-md cursor-pointer hover:shadow-md mr-2"),g(j,"type","button"),g(j,"class","add-rule-item py-2.5 mx-auto px-5 bg-primary-600 text-white rounded-md cursor-pointer hover:shadow-md"),g(T,"class","w-1/12 flex"),g(n,"id",C="fab-location-rule-"+t[0].id),g(n,"class","fab-location-rule-item flex my-2 gap-2")},m(e,o){c(e,n,o),i(n,l),i(n,r),i(n,a),i(a,d),i(n,h),i(n,_),i(_,$),i(n,b),i(n,v),i(v,x),i(n,O),i(n,G),i(G,A),i(n,I),i(n,T),i(T,E),i(T,M),i(T,j),N||(L=[m(E,"click",t[3]),m(j,"click",t[4])],N=!0)},p(e,[t]){2&t&&p!==(p="fab_location_type["+e[1].id+"][]")&&g(d,"name",p),2&t&&y!==(y="fab_location_operator["+e[1].id+"][]")&&g($,"name",y),2&t&&w!==(w="fab_location_value["+e[1].id+"][]")&&g(x,"name",w),2&t&&k!==(k="fab_location_logic["+e[1].id+"][]")&&g(A,"name",k),1&t&&C!==(C="fab-location-rule-"+e[0].id)&&g(n,"id",C)},i:e,o:e,d(e){e&&u(n),N=!1,o(L)}}}function z(e,t,n){let{rule:o={}}=t,{ruleGroup:l={}}=t,{defaultOptions:r,integrations:a,getComparatorOption:i,reloadSelect2:c,types:u}=window.FAB_METABOX_LOCATION,s=v();const d=e=>{const{type:t,operators:n,options:o}=e;return"select"===t?o??null:null};function f(e){const{operators:t}=e.params.data;n(0,o.type=jQuery(this).val(),o),n(0,o.operators=t??null,o),n(0,o.data=d(e.params.data),o),p(o)}const p=e=>{const t=jQuery(`#fab-location-rule-${e.id}`),n={placeholder:r.select2.placeholder};let o=jQuery('[name^="fab_location_value"]',t);if(o.hasClass("select2-hidden-accessible")&&(o.select2("destroy"),o.empty()),e.type&&e.type.includes("wc_"))o.replaceWith(`\n                <input \n                    name="fab_location_value[${l.id}][]" \n                    class="border border-gray-200 py-2.5 px-3 text-grey-darkest w-full" \n                    type="number" \n                    value="${e.value||""}" \n                />\n            `);else if(e.data)o.replaceWith(`\n                  <select\n                      name="fab_location_value[${l.id}][]"\n                      class="w-full select2">\n                  </select>\n              `),o=jQuery('.select2[name^="fab_location_value"]',t),c(o,{...n,data:e.data,selectedValue:e.value});else{o.replaceWith(`\n                <select \n                    name="fab_location_value[${l.id}][]" \n                    class="w-full select2">\n                </select>\n            `),o=jQuery('.select2[name^="fab_location_value"]',t);let r=i(e.type,{...n});!r.data&&e.value?e.value.ID?(r.data=[{id:e.value.ID,text:e.value.post_title}],r.selectedValue=e.value.ID):e.value.term_id?(r.data=[{id:e.value.term_id,text:e.value.name}],r.selectedValue=e.value.term_id):r.selectedValue=e.value:r.selectedValue=e.value,c(o,r)}let a=jQuery('.select2[name^="fab_location_operator"]',t),u={...n};if(e.type&&e.type.includes("wc_")){const t=window.FAB_METABOX_LOCATION.integrations.woocommerce.children.find((t=>t.id===e.type));u.data=t?t.operator:[]}else e.operators?u.data=e.operators:u.data=r.operator;u.selectedValue=e.operator,c(a,u)};b((()=>{const{get_type_data:e}=window.FAB_METABOX_LOCATION,t=e(o.type);let l,a,i=jQuery(`#fab-location-rule-${o.id}`),s={placeholder:r.select2.placeholder},m=[...r.type,...Object.values(u)];m.sort(((e,t)=>e.text.localeCompare(t.text))),l=jQuery('.select2[name^="fab_location_type"]',i),a={...s,data:m},o.type&&(a.selectedValue=o.type),c(l,a),l.on("select2:select",f);let g=t?.operators??r.operator;l=jQuery('.select2[name^="fab_location_operator"]',i),a={...s,data:g},a.selectedValue=o.operator,c(l,a),l=jQuery('.select2[name^="fab_location_logic',i),a={...s,data:r.logic},a.selectedValue=o.logic,c(l,a),t&&n(0,o.data=d(t),o),p(o)}));return e.$$set=e=>{"rule"in e&&n(0,o=e.rule),"ruleGroup"in e&&n(1,l=e.ruleGroup)},[o,l,s,()=>{s("remove_rule_item",{ruleId:o.id,ruleGroup:l})},()=>{s("add_rule_item",l)}]}class J extends q{constructor(e){super(),W(this,e,z,P,r,{rule:0,ruleGroup:1})}}function K(e){let t,n,o,l,r,a,d,f;return{c(){t=s("div"),n=s("div"),o=s("select"),l=s("option"),l.textContent="OR",r=s("option"),r.textContent="AND",l.__value="OR",l.value=l.__value,r.__value="AND",r.value=r.__value,g(o,"id",a="cgroup-logic-"+e[0].id),g(o,"class","select2 fab_cgroup_logic"),g(o,"name",d="fab_location_cgroup_logic["+(e[0].id-1)+"][]"),g(n,"class","field-control"),g(t,"class","rule-group-logic")},m(a,u){c(a,t,u),i(t,n),i(n,o),i(o,l),i(o,r),h(o,e[1][e[0].id-1].logic)},p(e,t){1&t&&a!==(a="cgroup-logic-"+e[0].id)&&g(o,"id",a),1&t&&d!==(d="fab_location_cgroup_logic["+(e[0].id-1)+"][]")&&g(o,"name",d),3&t&&f!==(f=e[1][e[0].id-1].logic)&&h(o,e[1][e[0].id-1].logic)},d(e){e&&u(t)}}}function U(e){let t,n,o,l,r,d,p,h,_,$=e[0].id>e[2]&&K(e);const y=e[5].default,b=function(e,t,n,o){if(e){const l=a(e,t,n,o);return e[0](l)}}(y,e,e[4],null);return{c(){$&&$.c(),t=f(),n=s("div"),b&&b.c(),o=f(),l=s("div"),r=s("button"),r.innerHTML='<em class="fas fa-trash"></em>',g(r,"type","button"),g(r,"class","remove-rule-group"),g(l,"class","fab-remove-rule-group"),g(n,"id",d="fab-location-rule-group-"+e[0].id),g(n,"class","fab-location-rule-group-item my-2 gap-2 px-5 py-4")},m(a,u){$&&$.m(a,u),c(a,t,u),c(a,n,u),b&&b.m(n,null),i(n,o),i(n,l),i(l,r),p=!0,h||(_=m(r,"click",e[6]),h=!0)},p(e,[o]){e[0].id>e[2]?$?$.p(e,o):($=K(e),$.c(),$.m(t.parentNode,t)):$&&($.d(1),$=null),b&&b.p&&(!p||16&o)&&function(e,t,n,o,l,r){if(l){const i=a(t,n,o,r);e.p(i,l)}}(b,y,e,e[4],p?function(e,t,n,o){if(e[2]&&o){const l=e[2](o(n));if(void 0===t.dirty)return l;if("object"==typeof l){const e=[],n=Math.max(t.dirty.length,l.length);for(let o=0;o<n;o+=1)e[o]=t.dirty[o]|l[o];return e}return t.dirty|l}return t.dirty}(y,e[4],o,null):function(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}(e[4]),null),(!p||1&o&&d!==(d="fab-location-rule-group-"+e[0].id))&&g(n,"id",d)},i(e){p||(Q(b,e),p=!0)},o(e){V(b,e),p=!1},d(e){$&&$.d(e),e&&u(t),e&&u(n),b&&b.d(e),h=!1,_()}}}function Y(e,t,n){let{$$slots:o={},$$scope:l}=t,{ruleGroup:r={}}=t,{ruleGroups:a=[]}=t,{firstIdGroup:i=0}=t,c=v();b((()=>{jQuery(`#cgroup-logic-${r.id}`).select2()}));return e.$$set=e=>{"ruleGroup"in e&&n(0,r=e.ruleGroup),"ruleGroups"in e&&n(1,a=e.ruleGroups),"firstIdGroup"in e&&n(2,i=e.firstIdGroup),"$$scope"in e&&n(4,l=e.$$scope)},[r,a,i,c,l,o,()=>{c("remove_rule_group",r)}]}class Z extends q{constructor(e){super(),W(this,e,Y,U,r,{ruleGroup:0,ruleGroups:1,firstIdGroup:2})}}function ee(e,t,n){const o=e.slice();return o[7]=t[n],o}function te(e,t,n){const o=e.slice();return o[6]=t[n],o}function ne(e,t){let n,o,l;return o=new J({props:{rule:t[6],ruleGroup:t[7]}}),o.$on("add_rule_item",t[2]),o.$on("remove_rule_item",t[4]),{key:e,first:null,c(){n=p(),S(o.$$.fragment),this.first=n},m(e,t){c(e,n,t),D(o,e,t),l=!0},p(e,n){t=e;const l={};2&n&&(l.rule=t[6]),2&n&&(l.ruleGroup=t[7]),o.$set(l)},i(e){l||(Q(o.$$.fragment,e),l=!0)},o(e){V(o.$$.fragment,e),l=!1},d(e){e&&u(n),R(o,e)}}}function oe(e){let t,n,o=[],l=new Map,r=e[7].rules;const a=e=>e[6].id;for(let t=0;t<r.length;t+=1){let n=te(e,r,t),i=a(n);l.set(i,o[t]=ne(i,n))}return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=p()},m(e,l){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,l);c(e,t,l),n=!0},p(e,n){22&n&&(r=e[7].rules,L(),o=H(o,n,a,1,e,r,l,t.parentNode,F,ne,t,te),B())},i(e){if(!n){for(let e=0;e<r.length;e+=1)Q(o[e]);n=!0}},o(e){for(let e=0;e<o.length;e+=1)V(o[e]);n=!1},d(e){for(let t=0;t<o.length;t+=1)o[t].d(e);e&&u(t)}}}function le(e,t){let n,o,l,r;function a(e){t[8](e)}let i={ruleGroup:t[7],ruleGroups:t[1],$$slots:{default:[oe]},$$scope:{ctx:t}};return void 0!==t[0]&&(i.firstIdGroup=t[0]),o=new Z({props:i}),w.push((()=>function(e,t,n){const o=e.$$.props[t];void 0!==o&&(e.$$.bound[o]=n,n(e.$$.ctx[o]))}(o,"firstIdGroup",a))),o.$on("remove_rule_group",t[5]),{key:e,first:null,c(){n=p(),S(o.$$.fragment),this.first=n},m(e,t){c(e,n,t),D(o,e,t),r=!0},p(e,n){t=e;const r={};var a;2&n&&(r.ruleGroup=t[7]),2&n&&(r.ruleGroups=t[1]),65538&n&&(r.$$scope={dirty:n,ctx:t}),!l&&1&n&&(l=!0,r.firstIdGroup=t[0],a=()=>l=!1,G.push(a)),o.$set(r)},i(e){r||(Q(o.$$.fragment,e),r=!0)},o(e){V(o.$$.fragment,e),r=!1},d(e){e&&u(n),R(o,e)}}}function re(e){let t,n,o,l,r,a,d,p,h,_,$,y,b,v,x,w=[],O=new Map,G=e[1];const A=e=>e[7].id;for(let t=0;t<G.length;t+=1){let n=ee(e,G,t),o=A(n);O.set(o,w[t]=le(o,n))}return{c(){t=s("div"),n=s("div"),n.innerHTML='Rules\n    <div class="text-gray-400"><em class="field-info">Create a set of rules...</em></div>',o=f(),l=s("div"),l.innerHTML='<em class="field-info">Show If:</em>',r=f(),a=s("div");for(let e=0;e<w.length;e+=1)w[e].c();d=f(),p=s("div"),h=s("div"),_=s("button"),_.innerHTML='<em class="fas fa-plus"></em>\n          Add a New &#39;AND&#39; / &#39;OR&#39; Group',$=f(),y=s("h2"),y.textContent="…Then allow FAB to be shown",g(n,"class","font-medium text-gray-600 pt-2 col-span-5"),g(l,"class","text-gray-400"),g(_,"type","button"),g(_,"class","button"),g(_,"id","add-rule-group"),g(h,"class","field-control"),g(p,"class","add-rule-group-trigger"),g(y,"class","end-rule-group-trigger"),g(a,"id","fab-location-rules"),g(t,"class","fab-container metabox-location")},m(u,s){c(u,t,s),i(t,n),i(t,o),i(t,l),i(t,r),i(t,a);for(let e=0;e<w.length;e+=1)w[e]&&w[e].m(a,null);i(a,d),i(a,p),i(p,h),i(h,_),i(a,$),i(a,y),b=!0,v||(x=m(_,"click",e[3]),v=!0)},p(e,[t]){55&t&&(G=e[1],L(),w=H(w,t,A,1,e,G,O,a,F,le,d,ee),B())},i(e){if(!b){for(let e=0;e<G.length;e+=1)Q(w[e]);b=!0}},o(e){for(let e=0;e<w.length;e+=1)V(w[e]);b=!1},d(e){e&&u(t);for(let e=0;e<w.length;e+=1)w[e].d();v=!1,x()}}}function ae(e,t,n){window.FAB_METABOX_LOCATION.init_type_options();let o=0,l=0,r=l,a=[],i=[],c={id:o,type:null,operator:null,logic:null,value:null},u={id:l,logic:null,rules:[]};window.FAB_METABOX_LOCATION.data.locations.length?i=window.FAB_METABOX_LOCATION.data.locations.map((e=>({id:l++,logic:e.logic,rules:e.rules.map((e=>({...e,id:o++})))}))):(a=[c],i=[{...u,rules:a}],o++,l++);return[r,i,e=>{const t=i.findIndex((t=>t.id===e.detail.id));-1!==t&&n(1,i[t].rules=[...i[t].rules,{...c,id:o++}],i)},()=>{const e={id:o++,type:null,operator:null,logic:null,value:null};n(1,i=[...i,{id:l++,logic:null,rules:[e]}]),i.length>1&&null==i[i.length-2].logic&&(n(1,i[i.length-2].logic="OR",i),setTimeout((()=>{jQuery("#cgroup-logic-"+(l-1)).val("OR").trigger("change")}),100))},e=>{const{ruleId:t,ruleGroup:l}=e.detail,r=i.findIndex((e=>e.id===l.id));if(-1!==r){const e=i[r].rules;e.length>1?n(1,i[r].rules=e.filter((e=>e.id!==t)),i):n(1,i[r].rules=[{...c,id:o++}],i)}},e=>{-1!==i.findIndex((t=>t.id===e.detail.id))&&(i.length>1?n(1,i=i.filter((t=>t.id!==e.detail.id))):n(1,i=[{...u,id:l++,rules:[{...c,id:o++}]}]),i.length>0&&n(0,r=i[0].id))},c,u,function(e){r=e,n(0,r)}]}return new class extends q{constructor(e){super(),W(this,e,ae,re,r,{})}}({target:document.querySelector("#fab-metabox-locations")})}();
//# sourceMappingURL=bundle.js.map
