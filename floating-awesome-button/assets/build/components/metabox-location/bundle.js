var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function l(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,n,o){return e[1]&&o?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](o(t))):n.ctx}function u(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function a(e){e.parentNode&&e.parentNode.removeChild(e)}function s(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function f(){return d(" ")}function p(){return d("")}function g(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function _(e,t,n){for(let n=0;n<e.options.length;n+=1){const o=e.options[n];if(o.__value===t)return void(o.selected=!0)}n&&void 0===t||(e.selectedIndex=-1)}let h;function $(e){h=e}function b(){if(!h)throw new Error("Function called outside component initialization");return h}function y(e){b().$$.on_mount.push(e)}function v(){const e=b();return(t,n,{cancelable:o=!1}={})=>{const l=e.$$.callbacks[t];if(l){const r=function(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const l=document.createEvent("CustomEvent");return l.initCustomEvent(e,n,o,t),l}(t,n,{cancelable:o});return l.slice().forEach((t=>{t.call(e,r)})),!r.defaultPrevented}return!0}}const w=[],O=[];let A=[];const x=[],T=Promise.resolve();let B=!1;function I(e){A.push(e)}const E=new Set;let M=0;function G(){if(0!==M)return;const e=h;do{try{for(;M<w.length;){const e=w[M];M++,$(e),C(e.$$)}}catch(e){throw w.length=0,M=0,e}for($(null),w.length=0,M=0;O.length;)O.pop()();for(let e=0;e<A.length;e+=1){const t=A[e];E.has(t)||(E.add(t),t())}A.length=0}while(w.length);for(;x.length;)x.pop()();B=!1,E.clear(),$(e)}function C(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(I)}}const N=new Set;let L;function k(){L={r:0,c:[],p:L}}function F(){L.r||o(L.c),L=L.p}function j(e,t){e&&e.i&&(N.delete(e),e.i(t))}function X(e,t,n,o){if(e&&e.o){if(N.has(e))return;N.add(e),L.c.push((()=>{N.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}else o&&o()}function Q(e,t){X(e,1,1,(()=>{t.delete(e.key)}))}function S(e,t,n,l,r,i,u,c,a,s,d,f){let p=e.length,g=i.length,m=p;const _={};for(;m--;)_[e[m].key]=m;const h=[],$=new Map,b=new Map,y=[];for(m=g;m--;){const e=f(r,i,m),o=n(e);let c=u.get(o);c?l&&y.push((()=>c.p(e,t))):(c=s(o,e),c.c()),$.set(o,h[m]=c),o in _&&b.set(o,Math.abs(m-_[o]))}const v=new Set,w=new Set;function O(e){j(e,1),e.m(c,d),u.set(e.key,e),d=e.first,g--}for(;p&&g;){const t=h[g-1],n=e[p-1],o=t.key,l=n.key;t===n?(d=t.first,p--,g--):$.has(l)?!u.has(o)||v.has(o)?O(t):w.has(l)?p--:b.get(o)>b.get(l)?(w.add(o),O(t)):(v.add(l),p--):(a(n,u),p--)}for(;p--;){const t=e[p];$.has(t.key)||a(t,u)}for(;g;)O(h[g-1]);return o(y),h}function V(e){e&&e.c()}function H(e,n,r,i){const{fragment:u,after_update:c}=e.$$;u&&u.m(n,r),i||I((()=>{const n=e.$$.on_mount.map(t).filter(l);e.$$.on_destroy?e.$$.on_destroy.push(...n):o(n),e.$$.on_mount=[]})),c.forEach(I)}function D(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];A.forEach((o=>-1===e.indexOf(o)?t.push(o):n.push(o))),n.forEach((e=>e())),A=t}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function R(e,t){-1===e.$$.dirty[0]&&(w.push(e),B||(B=!0,T.then(G)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function q(t,l,r,i,u,c,s,d=[-1]){const f=h;$(t);const p=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(f?f.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:l.target||f.$$.root};s&&s(p.root);let g=!1;if(p.ctx=r?r(t,l.props||{},((e,n,...o)=>{const l=o.length?o[0]:n;return p.ctx&&u(p.ctx[e],p.ctx[e]=l)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](l),g&&R(t,e)),n})):[],p.update(),g=!0,o(p.before_update),p.fragment=!!i&&i(p.ctx),l.target){if(l.hydrate){const e=function(e){return Array.from(e.childNodes)}(l.target);p.fragment&&p.fragment.l(e),e.forEach(a)}else p.fragment&&p.fragment.c();l.intro&&j(t.$$.fragment),H(t,l.target,l.anchor,l.customElement),G()}$(f)}class P{$destroy(){D(this,1),this.$destroy=e}$on(t,n){if(!l(n))return e;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const e=o.indexOf(n);-1!==e&&o.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function W(t){let n,l,r,i,d,p,_,h,$,b,y,v,w,O,A,x,T,B,I,E,M,G,C,N,L,k;return{c(){n=s("div"),l=s("div"),l.innerHTML='<div class="inline-block py-2.5 mx-auto px-5 bg-white text-gray-500 border border-text-gray-300 rounded-md cursor-grab"><em class="fas fa-bars"></em></div>',r=f(),i=s("div"),d=s("select"),_=f(),h=s("div"),$=s("select"),y=f(),v=s("div"),w=s("select"),A=f(),x=s("div"),T=s("select"),I=f(),E=s("div"),M=s("button"),M.innerHTML='<em class="fas fa-minus"></em>',G=f(),C=s("button"),C.innerHTML='<em class="fas fa-plus"></em>',m(l,"class","w-14"),m(d,"name",p="fab_location_type["+t[1].id+"][]"),m(d,"class","select2"),m(i,"class","w-2/12"),m($,"name",b="fab_location_operator["+t[1].id+"][]"),m($,"class","select2"),m(h,"class","w-2/12"),m(w,"name",O="fab_location_value["+t[1].id+"][]"),m(w,"class","w-full select2"),m(v,"class","w-4/12"),m(T,"name",B="fab_location_logic["+t[1].id+"][]"),m(T,"class","w-full select2"),m(x,"class","w-1/12"),m(M,"type","button"),m(M,"class","remove-rule-item py-2.5 mx-auto px-5 bg-danger-600 text-white rounded-md cursor-pointer hover:shadow-md mr-2"),m(C,"type","button"),m(C,"class","add-rule-item py-2.5 mx-auto px-5 bg-primary-600 text-white rounded-md cursor-pointer hover:shadow-md"),m(E,"class","w-1/12 flex"),m(n,"id",N="fab-location-rule-"+t[0].id),m(n,"class","fab-location-rule-item flex my-2 gap-2")},m(e,o){c(e,n,o),u(n,l),u(n,r),u(n,i),u(i,d),u(n,_),u(n,h),u(h,$),u(n,y),u(n,v),u(v,w),u(n,A),u(n,x),u(x,T),u(n,I),u(n,E),u(E,M),u(E,G),u(E,C),L||(k=[g(M,"click",t[3]),g(C,"click",t[4])],L=!0)},p(e,[t]){2&t&&p!==(p="fab_location_type["+e[1].id+"][]")&&m(d,"name",p),2&t&&b!==(b="fab_location_operator["+e[1].id+"][]")&&m($,"name",b),2&t&&O!==(O="fab_location_value["+e[1].id+"][]")&&m(w,"name",O),2&t&&B!==(B="fab_location_logic["+e[1].id+"][]")&&m(T,"name",B),1&t&&N!==(N="fab-location-rule-"+e[0].id)&&m(n,"id",N)},i:e,o:e,d(e){e&&a(n),L=!1,o(k)}}}function z(e,t,n){let{rule:o={}}=t,{ruleGroup:l={}}=t,r=v();function i(){n(0,o.type=jQuery(this).val(),o),n(0,o.value=null,o),u(o)}const u=e=>{const t=jQuery(`#fab-location-rule-${e.id}`),n={placeholder:window.FAB_METABOX_LOCATION.defaultOptions.select2.placeholder};let o=jQuery('[name^="fab_location_value"]',t);if(o.hasClass("select2-hidden-accessible")&&(o.select2("destroy"),o.empty()),e.type&&e.type.includes("fab_wc"))o.replaceWith(`\n                <input \n                    name="fab_location_value[${l.id}][]" \n                    class="border border-gray-200 py-2.5 px-3 text-grey-darkest w-full" \n                    type="number" \n                    value="${e.value||""}" \n                />\n            `);else{o.replaceWith(`\n                <select \n                    name="fab_location_value[${l.id}][]" \n                    class="w-full select2">\n                </select>\n            `),o=jQuery('.select2[name^="fab_location_value"]',t);let r=window.FAB_METABOX_LOCATION.getComparatorOption(e.type,{...n});!r.data&&e.value?e.value.ID?(r.data=[{id:e.value.ID,text:e.value.post_title}],r.selectedValue=e.value.ID):e.value.term_id?(r.data=[{id:e.value.term_id,text:e.value.name}],r.selectedValue=e.value.term_id):r.selectedValue=e.value:r.selectedValue=e.value,window.FAB_METABOX_LOCATION.reloadSelect2(o,r)}let r=jQuery('.select2[name^="fab_location_operator"]',t),i={...n};if(e.type&&e.type.includes("fab_wc")){const t=window.FAB_METABOX_LOCATION.objects.children.find((t=>t.id===e.type));i.data=t?t.operator:[]}else i.data=window.FAB_METABOX_LOCATION.defaultOptions.operator;i.selectedValue=e.operator,window.FAB_METABOX_LOCATION.reloadSelect2(r,i)};y((()=>{let e,t,n=jQuery(`#fab-location-rule-${o.id}`),l={placeholder:window.FAB_METABOX_LOCATION.defaultOptions.select2.placeholder};e=jQuery('.select2[name^="fab_location_type"]',n),t={...l,data:window.FAB_METABOX_LOCATION.defaultOptions.type},o.type&&(t.selectedValue=o.type),window.FAB_METABOX_LOCATION.reloadSelect2(e,t),e.on("change",i),e.on("select2:select",i),e=jQuery('.select2[name^="fab_location_operator"]',n),t={...l,data:window.FAB_METABOX_LOCATION.defaultOptions.operator},t.selectedValue=o.operator,window.FAB_METABOX_LOCATION.reloadSelect2(e,t),e=jQuery('.select2[name^="fab_location_logic',n),t={...l,data:window.FAB_METABOX_LOCATION.defaultOptions.logic},t.selectedValue=o.logic,window.FAB_METABOX_LOCATION.reloadSelect2(e,t),u(o)}));return e.$$set=e=>{"rule"in e&&n(0,o=e.rule),"ruleGroup"in e&&n(1,l=e.ruleGroup)},[o,l,r,()=>{r("remove_rule_item",{ruleId:o.id,ruleGroup:l})},()=>{r("add_rule_item",l)}]}class J extends P{constructor(e){super(),q(this,e,z,W,r,{rule:0,ruleGroup:1})}}function K(e){let t,n,o,l,r,i,d,f;return{c(){t=s("div"),n=s("div"),o=s("select"),l=s("option"),l.textContent="OR",r=s("option"),r.textContent="AND",l.__value="OR",l.value=l.__value,r.__value="AND",r.value=r.__value,m(o,"id",i="cgroup-logic-"+e[0].id),m(o,"class","select2 fab_cgroup_logic"),m(o,"name",d="fab_location_cgroup_logic["+(e[0].id-1)+"][]"),m(n,"class","field-control"),m(t,"class","rule-group-logic")},m(i,a){c(i,t,a),u(t,n),u(n,o),u(o,l),u(o,r),_(o,e[1][e[0].id-1].logic)},p(e,t){1&t&&i!==(i="cgroup-logic-"+e[0].id)&&m(o,"id",i),1&t&&d!==(d="fab_location_cgroup_logic["+(e[0].id-1)+"][]")&&m(o,"name",d),3&t&&f!==(f=e[1][e[0].id-1].logic)&&_(o,e[1][e[0].id-1].logic)},d(e){e&&a(t)}}}function U(e){let t,n,o,l,r,d,p,_,h,$=e[0].id>e[2]&&K(e);const b=e[5].default,y=function(e,t,n,o){if(e){const l=i(e,t,n,o);return e[0](l)}}(b,e,e[4],null);return{c(){$&&$.c(),t=f(),n=s("div"),y&&y.c(),o=f(),l=s("div"),r=s("button"),r.innerHTML='<em class="fas fa-trash"></em>',m(r,"type","button"),m(r,"class","remove-rule-group"),m(l,"class","fab-remove-rule-group"),m(n,"id",d="fab-location-rule-group-"+e[0].id),m(n,"class","fab-location-rule-group-item my-2 gap-2 px-5 py-4")},m(i,a){$&&$.m(i,a),c(i,t,a),c(i,n,a),y&&y.m(n,null),u(n,o),u(n,l),u(l,r),p=!0,_||(h=g(r,"click",e[6]),_=!0)},p(e,[o]){e[0].id>e[2]?$?$.p(e,o):($=K(e),$.c(),$.m(t.parentNode,t)):$&&($.d(1),$=null),y&&y.p&&(!p||16&o)&&function(e,t,n,o,l,r){if(l){const u=i(t,n,o,r);e.p(u,l)}}(y,b,e,e[4],p?function(e,t,n,o){if(e[2]&&o){const l=e[2](o(n));if(void 0===t.dirty)return l;if("object"==typeof l){const e=[],n=Math.max(t.dirty.length,l.length);for(let o=0;o<n;o+=1)e[o]=t.dirty[o]|l[o];return e}return t.dirty|l}return t.dirty}(b,e[4],o,null):function(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}(e[4]),null),(!p||1&o&&d!==(d="fab-location-rule-group-"+e[0].id))&&m(n,"id",d)},i(e){p||(j(y,e),p=!0)},o(e){X(y,e),p=!1},d(e){$&&$.d(e),e&&a(t),e&&a(n),y&&y.d(e),_=!1,h()}}}function Y(e,t,n){let{$$slots:o={},$$scope:l}=t,{ruleGroup:r={}}=t,{ruleGroups:i=[]}=t,{firstIdGroup:u=0}=t,c=v();y((()=>{jQuery(`#cgroup-logic-${r.id}`).select2()}));return e.$$set=e=>{"ruleGroup"in e&&n(0,r=e.ruleGroup),"ruleGroups"in e&&n(1,i=e.ruleGroups),"firstIdGroup"in e&&n(2,u=e.firstIdGroup),"$$scope"in e&&n(4,l=e.$$scope)},[r,i,u,c,l,o,()=>{c("remove_rule_group",r)}]}class Z extends P{constructor(e){super(),q(this,e,Y,U,r,{ruleGroup:0,ruleGroups:1,firstIdGroup:2})}}function ee(e,t,n){const o=e.slice();return o[7]=t[n],o}function te(e,t,n){const o=e.slice();return o[6]=t[n],o}function ne(e,t){let n,o,l;return o=new J({props:{rule:t[6],ruleGroup:t[7]}}),o.$on("add_rule_item",t[2]),o.$on("remove_rule_item",t[4]),{key:e,first:null,c(){n=p(),V(o.$$.fragment),this.first=n},m(e,t){c(e,n,t),H(o,e,t),l=!0},p(e,n){t=e;const l={};2&n&&(l.rule=t[6]),2&n&&(l.ruleGroup=t[7]),o.$set(l)},i(e){l||(j(o.$$.fragment,e),l=!0)},o(e){X(o.$$.fragment,e),l=!1},d(e){e&&a(n),D(o,e)}}}function oe(e){let t,n,o=[],l=new Map,r=e[7].rules;const i=e=>e[6].id;for(let t=0;t<r.length;t+=1){let n=te(e,r,t),u=i(n);l.set(u,o[t]=ne(u,n))}return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=p()},m(e,l){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,l);c(e,t,l),n=!0},p(e,n){22&n&&(r=e[7].rules,k(),o=S(o,n,i,1,e,r,l,t.parentNode,Q,ne,t,te),F())},i(e){if(!n){for(let e=0;e<r.length;e+=1)j(o[e]);n=!0}},o(e){for(let e=0;e<o.length;e+=1)X(o[e]);n=!1},d(e){for(let t=0;t<o.length;t+=1)o[t].d(e);e&&a(t)}}}function le(e,t){let n,o,l,r;function i(e){t[8](e)}let u={ruleGroup:t[7],ruleGroups:t[1],$$slots:{default:[oe]},$$scope:{ctx:t}};return void 0!==t[0]&&(u.firstIdGroup=t[0]),o=new Z({props:u}),O.push((()=>function(e,t,n){const o=e.$$.props[t];void 0!==o&&(e.$$.bound[o]=n,n(e.$$.ctx[o]))}(o,"firstIdGroup",i))),o.$on("remove_rule_group",t[5]),{key:e,first:null,c(){n=p(),V(o.$$.fragment),this.first=n},m(e,t){c(e,n,t),H(o,e,t),r=!0},p(e,n){t=e;const r={};var i;2&n&&(r.ruleGroup=t[7]),2&n&&(r.ruleGroups=t[1]),65538&n&&(r.$$scope={dirty:n,ctx:t}),!l&&1&n&&(l=!0,r.firstIdGroup=t[0],i=()=>l=!1,x.push(i)),o.$set(r)},i(e){r||(j(o.$$.fragment,e),r=!0)},o(e){X(o.$$.fragment,e),r=!1},d(e){e&&a(n),D(o,e)}}}function re(e){let t,n,o,l,r,i,d,p,_,h,$,b,y,v,w,O=[],A=new Map,x=e[1];const T=e=>e[7].id;for(let t=0;t<x.length;t+=1){let n=ee(e,x,t),o=T(n);A.set(o,O[t]=le(o,n))}return{c(){t=s("div"),n=s("div"),n.innerHTML='Rules\n        <div class="text-gray-400"><em class="field-info">Create a set of rules...</em></div>',o=f(),l=s("div"),l.innerHTML='<em class="field-info">Show If:</em>',r=f(),i=s("div");for(let e=0;e<O.length;e+=1)O[e].c();d=f(),p=s("div"),_=s("div"),h=s("button"),h.innerHTML='<em class="fas fa-plus"></em>\n                    Add a New &#39;AND&#39; / &#39;OR&#39; Group',$=f(),b=s("h2"),b.textContent="…Then allow FAB to be shown",m(n,"class","font-medium text-gray-600 pt-2 col-span-5"),m(l,"class","text-gray-400"),m(h,"type","button"),m(h,"class","button"),m(h,"id","add-rule-group"),m(_,"class","field-control"),m(p,"class","add-rule-group-trigger"),m(b,"class","end-rule-group-trigger"),m(i,"id","fab-location-rules"),m(t,"class","fab-container metabox-location")},m(a,s){c(a,t,s),u(t,n),u(t,o),u(t,l),u(t,r),u(t,i);for(let e=0;e<O.length;e+=1)O[e]&&O[e].m(i,null);u(i,d),u(i,p),u(p,_),u(_,h),u(i,$),u(i,b),y=!0,v||(w=g(h,"click",e[3]),v=!0)},p(e,[t]){55&t&&(x=e[1],k(),O=S(O,t,T,1,e,x,A,i,Q,le,d,ee),F())},i(e){if(!y){for(let e=0;e<x.length;e+=1)j(O[e]);y=!0}},o(e){for(let e=0;e<O.length;e+=1)X(O[e]);y=!1},d(e){e&&a(t);for(let e=0;e<O.length;e+=1)O[e].d();v=!1,w()}}}function ie(e,t,n){window.FAB_METABOX_LOCATION.init_type_options();let o=0,l=0,r=l,i=[],u=[],c={id:o,type:null,operator:null,logic:null,value:null},a={id:l,logic:null,rules:[]};window.FAB_METABOX_LOCATION.data.locations.length?u=window.FAB_METABOX_LOCATION.data.locations.map((e=>({id:l++,logic:e.logic,rules:e.rules.map((e=>({...e,id:o++})))}))):(i=[c],u=[{...a,rules:i}],o++,l++);return[r,u,e=>{const t=u.findIndex((t=>t.id===e.detail.id));-1!==t&&n(1,u[t].rules=[...u[t].rules,{...c,id:o++}],u)},()=>{const e={id:o++,type:null,operator:null,logic:null,value:null};n(1,u=[...u,{id:l++,logic:null,rules:[e]}]),u.length>1&&null==u[u.length-2].logic&&(n(1,u[u.length-2].logic="OR",u),setTimeout((()=>{jQuery("#cgroup-logic-"+(l-1)).val("OR").trigger("change")}),100))},e=>{const{ruleId:t,ruleGroup:l}=e.detail,r=u.findIndex((e=>e.id===l.id));if(-1!==r){const e=u[r].rules;e.length>1?n(1,u[r].rules=e.filter((e=>e.id!==t)),u):n(1,u[r].rules=[{...c,id:o++}],u)}},e=>{-1!==u.findIndex((t=>t.id===e.detail.id))&&(u.length>1?n(1,u=u.filter((t=>t.id!==e.detail.id))):n(1,u=[{...a,id:l++,rules:[{...c,id:o++}]}]),u.length>0&&n(0,r=u[0].id))},c,a,function(e){r=e,n(0,r)}]}return new class extends P{constructor(e){super(),q(this,e,ie,re,r,{})}}({target:document.querySelector("#fab-metabox-locations")})}();
