window.FAB_METABOX_LOCATION={...window.FAB_METABOX_LOCATION,defaultOptions:{...window.FAB_METABOX_LOCATION.defaultOptions,select2:{placeholder:"--choose--"},type:[],post_types:[]},init:()=>{jQuery("#post").on("submit",function(){let r=window.FAB_METABOX_LOCATION.check_invalid_rules();if(jQuery("#fab-location-rules .fab-location-rule-item").length==1&&r){let e=jQuery("#fab-location-rules .fab-location-rule-item").last();return jQuery('.select2[name^="fab_location_type',e).val(""),jQuery('.select2[name^="fab_location_type',e).trigger("change"),jQuery('.select2[name^="fab_location_operator',e).val(""),jQuery('.select2[name^="fab_location_operator',e).trigger("change"),jQuery('.select2[name^="fab_location_value',e).val(""),jQuery('.select2[name^="fab_location_value',e).trigger("change"),jQuery('.select2[name^="fab_location_logic',e).val(""),jQuery('.select2[name^="fab_location_logic',e).trigger("change"),!0}return r&&jQuery.dialog({icon:"fas fa-times",closeIcon:!0,animation:"scale",columnClass:"j-small",title:"Error",content:"Please check input, there are invalid location rules!"}),!r})},init_type_options:()=>{let r=window.FAB_METABOX_LOCATION.post_types;r=Object.keys(r).sort().map(function(e,i){return{id:e,text:r[e].label}}),r=r.filter(function(e,i){return!window.FAB_METABOX_LOCATION.excludes_post_types.includes(e.id)});let t=window.FAB_METABOX_LOCATION.post_taxonomies;t=Object.keys(t).sort().map(function(e,i){return{id:e,text:t[e].labels.name}}),window.FAB_METABOX_LOCATION.defaultOptions.post_types=r,window.FAB_METABOX_LOCATION.defaultOptions.type=[...window.FAB_METABOX_LOCATION.defaultOptions.type,{text:"Post",children:[{id:"post_type",text:"Post Type"},...r.map(function(e,i){let a=e.text.substr(e.text.length-1);return a=a==="s"?e.text.substring(0,e.text.length-1):e.text,{id:`single_${e.id}`,text:`Single ${a}`}})]},{text:"Taxonomy",children:[...t.map(function(e,i){return{id:`taxonomy_${e.id}`,text:`${e.text} (${e.id})`}})]},{text:"User",children:[{id:"user_session",text:"Session"},{id:"user_role",text:"Role"}]},window.FAB_METABOX_LOCATION.objects]},check_invalid_rules:()=>{let r=!1;return jQuery("#fab-location-rules .fab-location-rule-item").each(function(){let t;if(t=jQuery('.select2[name^="fab_location_type',this),!t.val()||(t=jQuery('.select2[name^="fab_location_operator',this),!t.val())||(t=jQuery('.select2[name^="fab_location_value',this),!t.val())||(t=jQuery('.select2[name^="fab_location_logic',this),!t.val()))return r=!0,!1}),r},reloadSelect2:(r,t)=>{t.selectedValue||(t.selectedValue=r.val()),r.data("select2")&&(r.select2("destroy"),r.empty()),r.select2(t),r.val(t.selectedValue),r.trigger("change")},getComparatorOption:(r,t)=>(r!==void 0&&r&&(r==="post_type"?t.data=window.FAB_METABOX_LOCATION.defaultOptions.post_types:r.includes("taxonomy_")?t.ajax=window.FAB_METABOX_LOCATION.getComparatorOptionTaxonomyTermAjax(r):r==="user_session"?t.data=[{id:"user_session_logged_in",text:"Logged In"}]:r==="user_role"?t.data=window.FAB_METABOX_LOCATION.defaultOptions.user.roles:r.includes("single_")&&(t.ajax=window.FAB_METABOX_LOCATION.getComparatorOptionSingleAjax(r))),t),getComparatorOptionSingleAjax:r=>({delay:500,dataType:"json",url:t=>{r=r.replace("single_","");let e=window.FAB_METABOX_LOCATION.post_types[r].rest_base;return e=e||r,e+=window.FAB_PLUGIN.isNumeric(t.term)?`/${t.term}`:"",`${window.FAB_METABOX_LOCATION.rest_url}wp/v2/${e}`},data:t=>{let e={_fields:"id,title"};return window.FAB_PLUGIN.isNumeric(t.term)||(e={...e,filter:{post_status:"publish,private"},page:t.page||1,search:t.term,orderby:"title",order:"asc"}),window.FAB_METABOX_LOCATION.ajax_params=e,e},processResults:function(t){let e={more:!1};return window.FAB_METABOX_LOCATION.ajax_params.page<this._request.getResponseHeader("X-WP-TotalPages")&&(e.more=!0),Array.isArray(t)||(t=[t]),t=t.map(function(i,a){return{id:i.id,text:i.title.rendered.replace(/[^\w\s]/gi,"")}}),{results:t,pagination:e}}}),getComparatorOptionTaxonomyTermAjax:r=>({delay:500,dataType:"json",url:t=>{r=r.replace("taxonomy_","");let e=window.FAB_METABOX_LOCATION.post_taxonomies[r].rest_base;return e=e||r,e+=window.FAB_PLUGIN.isNumeric(t.term)?`/${t.term}`:"",`${window.FAB_METABOX_LOCATION.rest_url}wp/v2/${e}`},data:t=>{let e={};return window.FAB_PLUGIN.isNumeric(t.term)||(e={page:t.page||1,per_page:10,search:t.term}),window.FAB_METABOX_LOCATION.ajax_params=e,e},processResults:function(t){let e={more:!1};return window.FAB_METABOX_LOCATION.ajax_params.page<this._request.getResponseHeader("X-WP-TotalPages")&&(e.more=!0),t=t.map(function(i,a){return{id:i.id,text:i.name.replace(/[^\w\s]/gi,"")}}),{results:t,pagination:e}}})};
